<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>éœ“è™¹è·³è·ƒ | Neon Jump</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{background:#0a0a2a;overflow:hidden;font-family:'Segoe UI',sans-serif;touch-action:none}
canvas{display:block;position:fixed;top:0;left:0;z-index:1}
#ui{position:fixed;top:0;left:0;width:100%;height:100%;z-index:10;pointer-events:none}
#hud{position:absolute;top:12px;left:0;width:100%;display:flex;justify-content:space-between;padding:0 20px;font-size:20px;font-weight:bold}
#sc-box{color:#0ff}
#lv-box{color:#f0f}
#combo-box{position:absolute;top:25%;left:50%;transform:translate(-50%,-50%);font-size:48px;font-weight:900;color:#ff0;opacity:0;transition:opacity 0.3s}
.screen{position:absolute;top:0;left:0;width:100%;height:100%;display:flex;flex-direction:column;align-items:center;justify-content:center;pointer-events:auto}
#menu{background:radial-gradient(ellipse at center,#1a0a3e,#0a0a2a)}
#gameover,#winscreen{background:rgba(10,10,30,0.95);display:none}
h1{font-size:60px;font-weight:900;background:linear-gradient(135deg,#0ff,#f0f,#ff0);-webkit-background-clip:text;-webkit-text-fill-color:transparent;margin-bottom:10px}
.sub{color:#888;font-size:16px;margin-bottom:30px}
button{padding:14px 40px;font-size:18px;border:2px solid #0ff;background:transparent;color:#0ff;border-radius:30px;cursor:pointer;margin:8px;pointer-events:auto}
button:hover{background:#0ff;color:#000}
.pink{border-color:#f0f;color:#f0f}
.pink:hover{background:#f0f;color:#000}
.big{font-size:50px;font-weight:900;margin-bottom:10px}
.info{color:#ccc;font-size:18px;margin-bottom:20px}
.hint{position:absolute;bottom:20px;color:#555;font-size:13px}
#mctrl{position:fixed;bottom:16px;left:0;width:100%;display:none;justify-content:space-between;padding:0 16px;z-index:20;pointer-events:auto}
.mb{width:70px;height:70px;border-radius:50%;border:2px solid rgba(0,255,255,0.5);background:rgba(0,255,255,0.15);color:#0ff;font-size:28px;display:flex;align-items:center;justify-content:center;user-select:none;-webkit-tap-highlight-color:transparent}
.mb:active{background:rgba(0,255,255,0.4)}
#mbj{border-color:rgba(255,0,255,0.5);background:rgba(255,0,255,0.15);color:#f0f;font-size:16px;font-weight:bold;width:80px;height:80px}
@media(max-width:900px){#mctrl{display:flex}}
</style>
</head>
<body>
<canvas id="gc"></canvas>
<div id="ui">
  <div id="hud"><div id="sc-box">âš¡ 0</div><div id="lv-box">å…³å¡ 1/5</div></div>
  <div id="combo-box"></div>
  <div id="menu" class="screen">
    <h1>éœ“è™¹è·³è·ƒ</h1>
    <div class="sub">åœ¨éœ“è™¹ç¯å…‰ä¸­è·ƒå‘å·…å³°</div>
    <button onclick="startGame()">å¼€å§‹æ¸¸æˆ</button>
    <div class="hint">âŒ¨ï¸ æ–¹å‘é”®/WASD ç§»åŠ¨è·³è·ƒ Â· æ‰‹æœºè§¦å±</div>
  </div>
  <div id="gameover" class="screen">
    <div class="big" style="color:#f44">ğŸ’€ å è½äº†</div>
    <div class="info">åˆ«ç°å¿ƒï¼Œå†è¯•ä¸€æ¬¡</div>
    <button class="pink" onclick="retry()">é‡æ–°æŒ‘æˆ˜</button>
  </div>
  <div id="winscreen" class="screen">
    <div class="big" style="color:#ff0">ğŸ‰ é€šå…³!</div>
    <div class="info">æ€»åˆ†: <span id="fscore">0</span></div>
    <button onclick="startGame()">å†æ¥ä¸€æ¬¡</button>
  </div>
</div>
<div id="mctrl">
  <div class="mb" id="ml">â—€</div>
  <div class="mb" id="mbj">è·³</div>
  <div class="mb" id="mr">â–¶</div>
</div>
<script>
// ç®€åŒ–çš„æ¸¸æˆé€»è¾‘ - ç¡®ä¿åŸºç¡€åŠŸèƒ½å¯ç”¨
var cv = document.getElementById('gc');
var ctx = cv.getContext('2d');
var W, H;

function resize() {
  W = cv.width = window.innerWidth;
  H = cv.height = window.innerHeight;
}
resize();
window.addEventListener('resize', resize);

// æ¸¸æˆçŠ¶æ€
var state = 'menu';
var score = 0, level = 1;
var player, platforms, coins, particles;

// è¾“å…¥æ§åˆ¶
var keys = {};
var ml = 0, mr = 0, mj = 0;

window.addEventListener('keydown', function(e) {
  keys[e.code] = true;
  if (['ArrowUp','ArrowDown','ArrowLeft','ArrowRight','Space','KeyW','KeyA','KeyS','KeyD'].includes(e.code)) {
    e.preventDefault();
  }
});

window.addEventListener('keyup', function(e) {
  keys[e.code] = false;
});

// è§¦æ‘¸æ§åˆ¶
function touchBind(id, cb) {
  var el = document.getElementById(id);
  el.addEventListener('touchstart', function(e) { e.preventDefault(); cb(1); }, {passive:false});
  el.addEventListener('touchend', function(e) { e.preventDefault(); cb(0); }, {passive:false});
  el.addEventListener('mousedown', function(e) { cb(1); });
  el.addEventListener('mouseup', function(e) { cb(0); });
}

touchBind('ml', function(v){ml=v});
touchBind('mr', function(v){mr=v});
touchBind('mbj', function(v){mj=v});

// ç”Ÿæˆå…³å¡
function generateLevel(lv) {
  platforms = [];
  coins = [];
  particles = [];
  
  // åœ°é¢ - éå¸¸æ˜¾çœ¼
  platforms.push({x: 0, y: H - 50, w: W, h: 50, ground: true});
  
  // ç©å®¶
  player = {
    x: W/2 - 16, y: H - 50 - 36, w: 32, h: 36,
    vx: 0, vy: 0, onGround: true
  };
  
  // å¹³å°
  var platCount = 6 + lv * 2;
  var curY = H - 50;
  var curX = W / 2;
  
  for (var i = 0; i < platCount; i++) {
    curY -= 55 + Math.random() * 25;
    curX += (Math.random() - 0.5) * 180;
    curX = Math.max(30, Math.min(W - 110, curX));
    
    platforms.push({x: curX, y: curY, w: 80, h: 16});
    
    // é‡‘å¸
    if (Math.random() < 0.6) {
      coins.push({x: curX + 40, y: curY - 20, collected: false});
    }
  }
}

// æ›´æ–°æ¸¸æˆé€»è¾‘
function updateGame(dt) {
  if (!player) return;
  
  var SPEED = 300, ACCEL = 1800, FRICTION = 0.85, GRAVITY = 1200, JUMP_VEL = -500;
  
  // è¾“å…¥
  var ix = 0;
  if (keys.ArrowLeft || keys.KeyA || ml) ix = -1;
  if (keys.ArrowRight || keys.KeyD || mr) ix = 1;
  
  // æ°´å¹³ç§»åŠ¨
  player.vx += ix * ACCEL * dt;
  player.vx *= Math.pow(FRICTION, dt * 60);
  if (Math.abs(player.vx) > SPEED) player.vx = Math.sign(player.vx) * SPEED;
  
  // è·³è·ƒ
  var wantJump = keys.ArrowUp || keys.KeyW || keys.Space || mj;
  if (wantJump && player.onGround) {
    player.vy = JUMP_VEL;
    player.onGround = false;
  }
  
  // é‡åŠ›
  player.vy += GRAVITY * dt;
  
  // ç§»åŠ¨
  player.x += player.vx * dt;
  player.y += player.vy * dt;
  
  // å¹³å°ç¢°æ’
  player.onGround = false;
  for (var i = 0; i < platforms.length; i++) {
    var p = platforms[i];
    if (player.vy >= 0 &&
        player.x + player.w > p.x &&
        player.x < p.x + p.w &&
        player.y + player.h >= p.y &&
        player.y + player.h <= p.y + 20) {
      player.y = p.y - player.h;
      player.vy = 0;
      player.onGround = true;
    }
  }
  
  // å±å¹•ç¯ç»•
  if (player.x + player.w < 0) player.x = W;
  if (player.x > W) player.x = -player.w;
  
  // é‡‘å¸æ”¶é›†
  for (var i = coins.length - 1; i >= 0; i--) {
    var c = coins[i];
    if (c.collected) continue;
    var dx = player.x + player.w/2 - c.x;
    var dy = player.y + player.h/2 - c.y;
    if (dx*dx + dy*dy < 400) {
      c.collected = true;
      score += 10;
    }
  }
  
  // æ­»äº¡æ£€æŸ¥
  if (player.y > H + 100) {
    state = 'dead';
    document.getElementById('gameover').style.display = 'flex';
    return;
  }
  
  // æ›´æ–°HUD
  document.getElementById('sc-box').textContent = 'âš¡ ' + score;
  document.getElementById('lv-box').textContent = 'å…³å¡ ' + level + '/5';
}

// ç»˜åˆ¶æ¸¸æˆ
function drawGame(dt) {
  // èƒŒæ™¯
  ctx.fillStyle = '#0a0a2a';
  ctx.fillRect(0, 0, W, H);
  
  // ç»˜åˆ¶å¹³å°
  for (var i = 0; i < platforms.length; i++) {
    var p = platforms[i];
    if (p.ground) {
      // åœ°é¢ - æ˜äº®æ˜¾çœ¼
      ctx.fillStyle = '#00e5ff';
      ctx.fillRect(p.x, p.y, p.w, p.h);
      ctx.fillStyle = 'rgba(255,255,255,0.5)';
      ctx.fillRect(p.x, p.y, p.w, 3);
    } else {
      // æ™®é€šå¹³å°
      ctx.fillStyle = '#ff00ff';
      ctx.fillRect(p.x, p.y, p.w, p.h);
      ctx.fillStyle = 'rgba(255,255,255,0.3)';
      ctx.fillRect(p.x + 2, p.y + 1, p.w - 4, 3);
    }
  }
  
  // ç»˜åˆ¶é‡‘å¸
  for (var i = 0; i < coins.length; i++) {
    var c = coins[i];
    if (c.collected) continue;
    ctx.fillStyle = '#ffdd00';
    ctx.beginPath();
    ctx.arc(c.x, c.y, 8, 0, Math.PI * 2);
    ctx.fill();
  }
  
  // ç»˜åˆ¶ç©å®¶
  if (player) {
    ctx.fillStyle = '#ff00ff';
    ctx.fillRect(player.x, player.y, player.w, player.h);
    
    // çœ¼ç›å’Œå˜´å·´
    ctx.fillStyle = '#000';
    var faceDir = Math.sign(player.vx) || 1;
    ctx.fillRect(player.x + 8 + faceDir * 3, player.y + 10, 5, 6);
    ctx.fillRect(player.x + 19 + faceDir * 3, player.y + 10, 5, 6);
    ctx.fillRect(player.x + 12 + faceDir * 2, player.y + 22, 8, 3);
  }
}

// ä¸»å¾ªç¯
var lastTime = 0;
function gameLoop(ts) {
  var dt = Math.min((ts - lastTime) / 1000, 0.05);
  lastTime = ts;
  
  if (state === 'play') updateGame(dt);
  drawGame(dt);
  
  requestAnimationFrame(gameLoop);
}

// å¼€å§‹æ¸¸æˆ
function startGame() {
  document.getElementById('menu').style.display = 'none';
  document.getElementById('gameover').style.display = 'none';
  document.getElementById('winscreen').style.display = 'none';
  score = 0; level = 1;
  generateLevel(1);
  state = 'play';
}

function retry() {
  document.getElementById('gameover').style.display = 'none';
  generateLevel(level);
  state = 'play';
}

// åˆå§‹åŒ–
particles = [];
requestAnimationFrame(gameLoop);
</script>
</body>
</html>